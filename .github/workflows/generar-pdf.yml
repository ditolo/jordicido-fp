name: Generar PDF único (orden del repositorio)

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Instalar Pandoc
      uses: pandoc/actions/setup@v1
      with:
        version: 3.1

    - name: Instalar wkhtmltopdf
      run: |
        sudo apt-get update
        sudo apt-get install -y wkhtmltopdf

    - name: Combinar Markdown respetando el árbol del repo
      run: |
        echo "Generando archivo combinado..."
        echo "" > combined.md

        while IFS= read -r f; do
          echo "## $(basename "$f")" >> combined.md
          cat "$f" >> combined.md
          echo -e "\n\n" >> combined.md
        done < <(find docs -type f -name "*.md" | sort)

    - name: Generar PDF único sin LaTeX
      run: |
        pandoc combined.md -o documento_unico.pdf \
          --from markdown \
          --to html5 \
          --pdf-engine=wkhtmltopdf \
          --toc \
          --number-sections \
          -V margin-top=20mm \
          -V margin-bottom=20mm \
          -V margin-left=15mm \
          -V margin-right=15mm \
          -V fontsize=12pt

    - name: Subir PDF como artifact
      uses: actions/upload-artifact@v4
      with:
        name: documento_unico
        path: documento_unico.pdf
